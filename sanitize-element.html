<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="sanitize-import.html">

<dom-module id="sanitize-element">
  <script>
    class SanitizeElement extends Polymer.Element {
      static get is() { return 'sanitize-element' }
      static get properties() { return {
        opt: String,
        sanitizer: {
          type: Function,
          notify: true,
          computed: "_sanitFunc()"
        } }
      }
      ready(){
        super.ready()
        this.sa = new Sanitize(JSON.parse(this.opt))
        this.xs = new XMLSerializer()
      }
      _sanitFunc() {
        return i=>{
          if (i.match(/^<\//)) return i
          let t = document.createElement('div')
          t.innerHTML=i
          return this.xs.serializeToString(this.sa.clean_node(t))
                     .replace(/ xmlns="[^"]+"/,'')
                     .replace(/<\/[^>]+>$/,'')
        }        
      }
    }
    customElements.define(SanitizeElement.is, SanitizeElement)
  </script>
</dom-module>
