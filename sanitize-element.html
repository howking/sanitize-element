<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="sanitize-import.html">

<!--
Element wrapper for the [Sanitize.js](https://github.com/gbirke/Sanitize.js) library.
work for [`<marked-element>`](https://github.com/polymerelements/marked-element).

@element sanitize-element
-->
<dom-module id="sanitize-element">
  <script>
    /**
     * `sanitize-element`
     * Element wrapper for the [Sanitize.js](https://github.com/gbirke/Sanitize.js) library.
     *
     * @customElement
     * @polymer
     */
    class SanitizeElement extends Polymer.Element {
      static get is() { return 'sanitize-element' }
      static get properties() { return {
        /**
         * custom configuration by JSON String
         * Note: The params attribute must be double quoted JSON.
         */
        config: Object,
        /**
         * Function used for marked.js
         */
        sanitizer: {
          type: Function,
          readOnly: true,
          notify: true,
          computed: "_sanitizer(config)"
        }
      } }
      /**
       * Return function of sanitizer for marked.js.
       *
       * @config config `JSON String`
       */
      _sanitizer(config) {
        let sa = new Sanitize(config)
        let xs = new XMLSerializer()
        return i=>{
          if (i.match(/^<\//)) return i
          let t = document.createElement('div')
          t.innerHTML=i
          return xs.serializeToString(sa.clean_node(t))
                   .replace(/ xmlns="[^"]+"/,'')
                   .replace(/<\/[^>]+>$/,'')
        }
      }
    }
    customElements.define(SanitizeElement.is, SanitizeElement)
  </script>
</dom-module>
